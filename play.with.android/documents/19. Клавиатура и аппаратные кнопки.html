<!DOCTYPE html>
<!-- saved from url=(0056)http://developer.alexanderklimov.ru/android/keyboard.php -->
<html class="mdl-js gr__developer_alexanderklimov_ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Android: Клавиатура и аппаратные кнопки</title>
   
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="./19. Клавиатура и аппаратные кнопки_files/bootstrap.min.css">
<link rel="stylesheet" href="./19. Клавиатура и аппаратные кнопки_files/font-awesome.min.css">
<link rel="stylesheet" href="./19. Клавиатура и аппаратные кнопки_files/custom.css">
    
<link rel="icon" href="http://developer.alexanderklimov.ru/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="http://developer.alexanderklimov.ru/favicon.ico" type="image/x-icon">
<style type="text/css">
body {
    padding-top: 60px;
    padding-bottom: 10px;
}

</style>

<link rel="stylesheet" href="./19. Клавиатура и аппаратные кнопки_files/material.indigo-light_blue.min.css"> 
<script src="./19. Клавиатура и аппаратные кнопки_files/cb=gapi.loaded_1" async=""></script><script src="./19. Клавиатура и аппаратные кнопки_files/cb=gapi.loaded_0" async=""></script><script type="text/javascript" async="" src="./19. Клавиатура и аппаратные кнопки_files/plusone.js.Без названия" gapi_processed="true"></script><script src="./19. Клавиатура и аппаратные кнопки_files/material.min.js.Без названия"></script><style type="text/css">
:root .banner_box,
:root .adv,
:root img[alt="Google+"],
:root .g-plusone,
:root .container > .infoBoxList > .shareInfoBox,
:root .back-to-top
{ display: none !important; }</style><style type="text/css">iframe[src="https://apis.google.com/u/0/se/0/_/+1/fastbutton?usegapi=1&size=small&annotation=inline&width=300&align=right&hl=ru&origin=http%3A%2F%2Fdeveloper.alexanderklimov.ru&url=http%3A%2F%2Fdeveloper.alexanderklimov.ru%2F&gsrc=3p&ic=1&jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.LDDegL6ImS0.O%2Fm%3D__features__%2Fam%3DAQ%2Frt%3Dj%2Fd%3D1%2Frs%3DAGLTcCO3moWK4VG6CcM19m5AII4n45L9HA#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&id=I0_1476609881233&parent=http%3A%2F%2Fdeveloper.alexanderklimov.ru&pfname=&rpctoken=19404199"],
img[src="http://db.c7.b3.a0.top.mail.ru/counter?id=228158;js=13;r=;j=false;s=1920*1080;d=24;rand=0.652267127730263"],
img[src="//ssl.gstatic.com/images/icons/gplus-16.png"],
img[src="http://db.c7.b3.a0.top.mail.ru/counter?id=228158;t=223;l=1"],
img[src="http://feeds.feedburner.com/~fc/alexanderklimov/VJcl?bg=0099CC&fg=444444&anim=0"],
iframe[src="https://apis.google.com/u/0/se/0/_/+1/fastbutton?usegapi=1&size=small&annotation=inline&width=300&align=right&hl=ru&origin=http%3A%2F%2Fdeveloper.alexanderklimov.ru&url=http%3A%2F%2Fdeveloper.alexanderklimov.ru%2Fandroid%2F&gsrc=3p&ic=1&jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.LDDegL6ImS0.O%2Fm%3D__features__%2Fam%3DAQ%2Frt%3Dj%2Fd%3D1%2Frs%3DAGLTcCO3moWK4VG6CcM19m5AII4n45L9HA#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&id=I0_1476609893478&parent=http%3A%2F%2Fdeveloper.alexanderklimov.ru&pfname=&rpctoken=91165856"],
img[src="http://db.c7.b3.a0.top.mail.ru/counter?id=228158;js=13;r=http%3A//developer.alexanderklimov.ru/;j=false;s=1920*1080;d=24;rand=0.5228171485325694"],
iframe[src="https://apis.google.com/u/0/se/0/_/+1/fastbutton?usegapi=1&size=small&annotation=inline&width=300&align=right&hl=ru&origin=http%3A%2F%2Fdeveloper.alexanderklimov.ru&url=http%3A%2F%2Fdeveloper.alexanderklimov.ru%2Fandroid%2Fsimplepaint.php&gsrc=3p&ic=1&jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.LDDegL6ImS0.O%2Fm%3D__features__%2Fam%3DAQ%2Frt%3Dj%2Fd%3D1%2Frs%3DAGLTcCO3moWK4VG6CcM19m5AII4n45L9HA#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&id=I0_1476609911615&parent=http%3A%2F%2Fdeveloper.alexanderklimov.ru&pfname=&rpctoken=10447599"],
img[src="http://db.c7.b3.a0.top.mail.ru/counter?id=228158;js=13;r=http%3A//developer.alexanderklimov.ru/android/;j=false;s=1920*1080;d=24;rand=0.05797381771465715"],
iframe[src="https://apis.google.com/u/0/se/0/_/+1/fastbutton?usegapi=1&size=small&annotation=inline&width=300&align=right&hl=ru&origin=http%3A%2F%2Fdeveloper.alexanderklimov.ru&url=http%3A%2F%2Fdeveloper.alexanderklimov.ru%2Fandroid%2Fsunrise.php&gsrc=3p&ic=1&jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.LDDegL6ImS0.O%2Fm%3D__features__%2Fam%3DAQ%2Frt%3Dj%2Fd%3D1%2Frs%3DAGLTcCO3moWK4VG6CcM19m5AII4n45L9HA#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Cdrefresh%2Cerefresh%2Conload&id=I0_1476609913600&parent=http%3A%2F%2Fdeveloper.alexanderklimov.ru&pfname=&rpctoken=26159412"],
img[src="http://db.c7.b3.a0.top.mail.ru/counter?id=228158;js=13;r=http%3A//developer.alexanderklimov.ru/android/;j=false;s=1920*1080;d=24;rand=0.2814448307699229"],
img[src="http://db.c7.b3.a0.top.mail.ru/counter?id=228158;js=13;r=http%3A//developer.alexanderklimov.ru/android/;j=false;s=1920*1080;d=24;rand=0.09221145924186391"]
{display:none !important;}</style>
<link rel="stylesheet" href="./19. Клавиатура и аппаратные кнопки_files/icon">
</head>

<body data-gr-c-s-loaded="true"><a href="http://developer.alexanderklimov.ru/android/keyboard.php#" class="back-to-top" nszz82r="" hidden="">Back to Top</a>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        
        <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
        <li class="active"><a href="http://developer.alexanderklimov.ru/android">Android <span class="sr-only">(current)</span></a></li>
        <li class=""><a href="http://developer.alexanderklimov.ru/dotnet/">C#/Visual Basic</a></li>
        <li class=""><a href="http://developer.alexanderklimov.ru/windowsphone/wp.php">Windows Phone</a></li>
        <li class=""><a href="http://developer.alexanderklimov.ru/php">PHP</a></li>
        <li class=""><a href="http://developer.alexanderklimov.ru/arduino">Arduino</a></li>
        <li class=""><a href="http://android-klimov.blogspot.ru/">Блог</a></li>
        </ul>


            <p class="navbar-text navbar-right">
			    <a data-toggle="modal" href="http://developer.alexanderklimov.ru/android/keyboard.php#myModal" class="navbar-link">Гость</a>
                
            </p>
        </div><!--/.nav-collapse -->
    </div>
</div>

<div class="container-fluid">
<div class="row">
    <div class="col-md-5">
        <p>
		<a href="http://developer.alexanderklimov.ru/"><img src="./19. Клавиатура и аппаратные кнопки_files/header.png" alt="Сайт разработчика Александра Климова" border="0" class="img-responsive"></a>
		</p>
    </div><!--/span-->
    
	<div class="col-md-5">
        <p style="color:green; font-style: italic; font-size: small;">
		/* Моя кошка замечательно разбирается в программировании. Стоит мне объяснить проблему ей - и все становится ясно. */<br>John Robbins, Debugging Applications, Microsoft Press, 2000
		</p>
    </div><!--/span-->
    
	<div class="col-md-2">
        <p>
		<a href="http://feeds.feedburner.com/alexanderklimov/VJcl"><img src="./19. Клавиатура и аппаратные кнопки_files/kot-2-rss-100.png" border="0"></a>
		</p>
    </div><!--/span-->
</div><!--/row-->
</div>    
<div class="clearfix"></div>
    
<noindex><!--Rating@Mail.ru COUNTER--><script language="JavaScript" type="text/javascript"><!--
d=document;var a='';a+=';r='+escape(d.referrer)
js=10//--></script><script language="JavaScript1.1" type="text/javascript"><!--
a+=';j='+navigator.javaEnabled()
js=11//--></script><script language="JavaScript1.2" type="text/javascript"><!--
s=screen;a+=';s='+s.width+'*'+s.height
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth)
js=12//--></script><script language="JavaScript1.3" type="text/javascript"><!--
js=13//--></script><script language="JavaScript" type="text/javascript"><!--
d.write('<IMG src="http://db.c7.b3.a0.top.mail.ru/counter'+
'?id=228158;js='+js+a+';rand='+Math.random()+
'" height="1" width="1" alt="top.mail.ru" border="0" />')
if(11<js)d.write('<'+'!-- ')//--></script><img src="http://db.c7.b3.a0.top.mail.ru/counter?id=228158;js=13;r=http%3A//developer.alexanderklimov.ru/android/;j=false;s=1920*1080;d=24;rand=0.34519250188156203" height="1" width="1" alt="top.mail.ru" border="0" hidden="" style="display: none !important;"><!-- <noscript><img
src="http://db.c7.b3.a0.top.mail.ru/counter?js=na;id=228158"
height="1" width="1" alt="top.mail.ru" border="0" /></noscript><script language="JavaScript" type="text/javascript"><!--
if(11<js)d.write('--'+'>')//--><!--/COUNTER--></noindex>
<div class="container-fluid">
    
    <div class="row">
        <!--левое меню -->
		<div class="col-md-2 well-lg">
            <div class="sidebar panel panel-default">
            <ul class="nav nav-pills nav-stacked">
<li class="active"><a href="http://developer.alexanderklimov.ru/android/index.php" class="leftmenu">Главная</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/theory/" class="leftmenu">Теория</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/views/" class="leftmenu">Palette</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/listview/" class="leftmenu">ListView</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/catshop/" class="leftmenu">Котошоп</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/animation/" class="leftmenu">Анимация</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/sqlite/" class="leftmenu">SQLite</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/opengles/" class="leftmenu">OpenGL ES</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/library/" class="leftmenu">Библиотеки</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/games/" class="leftmenu">Игры</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/wear/" class="leftmenu">Wear</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/emulator/" class="leftmenu">Эмулятор</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/studio/" class="leftmenu">Android Studio</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/tips-android.php" class="leftmenu">Советы</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/articles-android.php" class="leftmenu">Статьи</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/books.php" class="leftmenu">Книги</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/java/java.php" class="leftmenu">Java. Экспресс-курс</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/design/" class="leftmenu">Дизайн</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/debug/" class="leftmenu">Отладка</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/opensource.php" class="leftmenu">Open Source</a></li>
<li class=""><a href="http://developer.alexanderklimov.ru/android/links.php" class="leftmenu">Полезные ресурсы</a></li>
</ul>            </div><!--/.well -->
        </div><!--/span-->


        <div class="col-md-8">

		<div class="row">
            <div class="col-md-12">
			
			<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span></button>
            <h3 class="modal-title" id="myModalLabel">Читайте на здоровье!</h3>
        </div>
        <div class="modal-body">
            <p>Статья проплачена кошками - всемирно известными производителями котят.</p>
            <p>Если статья вам понравилась, то можете <a href="http://developer.alexanderklimov.ru/donate.php">поддержать проект</a>.</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
        </div>
        </div>
    </div>
</div>			
<h1 class="text-warning">Клавиатура и аппаратные кнопки</h1>

<p>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#keys">Аппаратные и клавиатурные клавиши</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#back">Кнопка Back: Вы уверены, что хотите выйти из программы?</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#doubleback">Двойное нажатие на кнопку Back</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#home">Кнопка Home</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#menu">Обработка кнопки Menu</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#hide">Прячем клавиатуру</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#settype">Изменить вид клавиатуры для данного EditText</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#enter">Переопределяем кнопку Enter</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#moveactivity">Сдвигаем активность</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#startactivity">Показываем клавиатуру при запуске активности</a><br>
<a href="http://developer.alexanderklimov.ru/android/keyboard.php#language">Узнать выбранный язык на клавиатуре</a><br>
</p>

<h2 class="text-warning" id="keys">Аппаратные и клавиатурные клавиши</h2>

<p>Обработка аппаратных клавиш и клавиатуры имеет следующие методы</p>

<ul>
<li><b>onKeyDown()</b> — вызывается при нажатии любой аппаратной клавиши;</li>
<li><b>onKeyUp()</b> — вызывается при отпускании любой аппаратной клавиши;</li>
</ul>

<p>Кроме клавиш, есть еще другие методы обработки пользовательского ввода (здесь не рассматриваются):</p>
<ul>
<li><b>onTrackballEvent()</b> — срабатывает при движениях трекбола;
</li><li><b>onTouchEvent()</b> — обработчик событий сенсорного экрана, срабатывает при касании, убирания пальца и при перетаскивании.</li>
</ul>

<p>Чтобы ваши компоненты и активности реагировали на нажатия клавиш, переопределите обработчики событий <b>onKeyUp()</b> и <b>onKeyDown()</b>:</p>

<pre><code class="java">
@Override
public boolean onKeyDown(int keyCode, KeyEvent event) {
    // Обработайте нажатие, верните true, если обработка выполнена
    return false;
}

@Override
public boolean onKeyUp(int keyCode, KeyEvent event) {
    // Обработайте отпускание клавиши, верните true, если обработка выполнена
  return false;
}
</code></pre>

<p>Параметр <b>keyCode</b> содержит код клавиши, которая была нажата; сравнивайте его со статическими кодами клавиш, хранящимися в классе <b>KeyEvent</b>, чтобы выполнять соответствующую обработку.</p>

<p>Параметр <b>KeyEvent</b> также включает в себя несколько методов: <b>isAltPressed()</b>, <b>isShiftPressed()</b> и <b>isSymPressed()</b>, определяющих, были ли нажаты функциональные клавиши, такие как Alt, Shift или Sym. Статический метод <b>isModifierKey()</b> принимает <b>keyCode</b> и определяет, является ли нажатая клавиша модификатором.</p>

<h2 class="text-warning" id="back">Кнопка Back: Вы уверены, что хотите выйти из программы?</h2>

<p>Кнопка Back (Назад) закрывает приложение, точнее текущую активность, но если приложение состоит из одной активности, то это равносильно закрытию всего приложения. В большинстве случаев вам нет никакого дела до неуклюжего пользователя, который по ошибке нажал на кнопку Back вместо кнопки <b>Подарить разработчику миллион</b>. Но, если ваша программа, будучи запущенной на телефоне пользователя, потихоньку списывает деньги клиента в счет Фонда голодных котов, то нужно дать ему шанс задуматься и вывести диалоговое окно с вопросом: "А действительно ли вы хотите выйти из программы?"</p>

<p>Чтобы реализовать такую задачу, нужно переопределить поведение кнопки Back через метод <b>onBackPressed()</b> следующим образом:</p>

<pre><code class="java">
@Override
public void onBackPressed() {
	// TODO Auto-generated method stub
	// super.onBackPressed();
	openQuitDialog();
}

private void openQuitDialog() {
	AlertDialog.Builder quitDialog = new AlertDialog.Builder(
			CustomViewDemoActivity.this);
	quitDialog.setTitle("Выход: Вы уверены?");

	quitDialog.setPositiveButton("Таки да!", new OnClickListener() {
		@Override
		public void onClick(DialogInterface dialog, int which) {
			// TODO Auto-generated method stub
			finish();
		}
	});

	quitDialog.setNegativeButton("Нет", new OnClickListener() {
		@Override
		public void onClick(DialogInterface dialog, int which) {
			// TODO Auto-generated method stub
		}
	});

	quitDialog.show();
}
</code></pre>

<p><img src="./19. Клавиатура и аппаратные кнопки_files/buttonback.png" alt="Переопределение кнопки Back"></p>

<p>Данный метод появился в Android 2.0. Для более ранних версий использовался стандартный код обработки <b>onKeyDown()</b>:</p>

<pre><code class="java">
@Override  
public boolean onKeyDown(int keyCode, KeyEvent event)  
{  
    //replaces the default 'Back' button action  
    if(keyCode == KeyEvent.KEYCODE_BACK)  
    {  
        // ваш код
    }  
    return true;  
}  
</code></pre>

<h2 class="text-warning" id="doubleback">Двойное нажатие на кнопку Back</h2>

<p>Другой вариант - выход из приложения при двойном нажатии на кнопку Back. Удобно в тех случаях, когда считаете, что пользователь может случайно нажать на кнопку, например, во время активной игры. Приложение закроется, если пользователь дважды нажмёт на кнопку в течение двух секунд.</p>

<pre><code class="java">
private static long back_pressed;

@Override
public void onBackPressed() {
	if (back_pressed + 2000 &gt; System.currentTimeMillis())
		super.onBackPressed();
	else
		Toast.makeText(getBaseContext(), "Press once again to exit!",
				Toast.LENGTH_SHORT).show();
	back_pressed = System.currentTimeMillis();
}
</code></pre>

<h2 class="text-warning" id="home">Кнопка Home</h2>

<p>Можно отследить нажатие кнопки <b>Home</b> через метод активности <b>onUserLeaveHint()</b>:</p>

<pre><code class="java">
@Override
protected void onUserLeaveHint() {
    Toast toast = Toast.makeText(getApplicationContext(), "Нажата кнопка HOME", Toast.LENGTH_SHORT);
    toast.show();
    super.onUserLeaveHint();
}
</code></pre>

<h2 class="text-warning" id="menu">Обработка кнопки Menu</h2>

<p>У телефона, кроме кнопки Back, есть еще кнопка Menu для вызова команд меню (на некоторых устройствах). Если необходимо обрабатывать нажатия этой кнопки (например, управление в игре), то используйте следующий код (обычное и долгое нажатие):</p>

<pre><code class="java">
@Override
public boolean onKeyDown(int keyCode, KeyEvent event) {
    if (keyCode == KeyEvent.KEYCODE_MENU) {
        event.startTracking();
        editText.setText("Key Down"); //вывожу текст в текстовом поле
        return true;
    }
    return super.onKeyDown(keyCode, event);
}

@Override
public boolean onKeyLongPress(int keyCode, KeyEvent event) {
    if (keyCode == KeyEvent.KEYCODE_MENU) {
    	editText.setText("Long Press"); //вывожу текст в текстовом поле
        return true;
    }
    return super.onKeyDown(keyCode, event);
}
</code></pre>

<p>Должен заметить, что длинное нажатие трудно уловить, так как обычное нажатие постоянно подавляет это событие.</p>

<h2 class="text-warning">Другие кнопки</h2>

<p>Ну на самом деле можно отслеживать не только нажатие кнопки Меню, но и кнопку Поиска и кнопки увеличения громкости.</p>

<pre><code class="java">
@Override
public boolean onKeyDown(int keyCode, KeyEvent event) {
	// TODO Auto-generated method stub
	switch (keyCode) {
	case KeyEvent.KEYCODE_MENU:
		Toast.makeText(this, "Нажата кнопка Меню", Toast.LENGTH_SHORT)
				.show();
		return true;
	case KeyEvent.KEYCODE_SEARCH:
		Toast.makeText(this, "Нажата кнопка Поиск", Toast.LENGTH_SHORT)
				.show();
		return true;
	case KeyEvent.KEYCODE_BACK:
		onBackPressed();
		return true;
	case KeyEvent.KEYCODE_VOLUME_UP:
		event.startTracking();
		return true;
	case KeyEvent.KEYCODE_VOLUME_DOWN:
		Toast.makeText(this, "Нажата кнопка громкости", Toast.LENGTH_SHORT)
				.show();
		return false;
	}
	return super.onKeyDown(keyCode, event);
}
</code></pre>

<p>Обратите внимание, что для кнопки громкости возвращаем <b>false</b>, т.е. мы не переопределяем поведение кнопки, а оставляем её на усмотрение системы.</p>

<p>Пример работы с кнопками громкости можно посмотреть в статье <a href="http://developer.alexanderklimov.ru/android/ringtone.php#volume">Рингтоны. Управление громкостью</a></p>

<p>По такому же принципу работает метод <b>onKeyUp()</b>. Метод <b>onKeyLongPress()</b> можно использовать, если в методе <b>onKeyDown()</b> был задействован метод <b>event.startTracking()</b>, отслеживающий поведение кнопки. В нашем примере мы отслеживали кнопку <b>Volume_Up</b>.</p>

<h2 class="text-warning" id="hide">Прячем клавиатуру</h2>

<p>В некоторых случаях хочется убрать клавиатуру с экрана, не нажимая кнопку Back, а программно. В одном моём приложении, где было много текстовых полей, я воспользовался следующим кодом при щелчке кнопки:</p>

<pre><code class="java">
// прячем клавиатуру. butCalculate - это кнопка
InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);
imm.hideSoftInputFromWindow(butCalculate.getWindowToken(),
		InputMethodManager.HIDE_NOT_ALWAYS);
</code></pre>

<p>Код так выглядит, если писать его в <b>Activity</b>. Если расположить его в другом классе, экземпляр <b>Activity</b> нужно передать туда как параметр и вызывать методы как <b>activity.getApplicationContext()</b>, где <b>activity</b> - экземпляр <b>Activity</b>.</p>

<p>Можно избавить компонент от фокуса:</p>

<pre><code class="java">
android:focusable="false"
</code></pre>

<p>Чтобы принудительно показать клавиатуру, используйте следующий код:</p>

<pre><code class="java">
InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);
imm.toggleSoftInput(InputMethodManager.SHOW_FORCED, 0);
</code></pre>

<p>Кстати, повторный вызов метода закроет клавиатуру. Указанный способ не требует наличия элементов <b>View</b>.</p>

<p>Если продолжить тему показа клавиатуры, то может возникнуть следующая ситуация. Допустим у вас есть <b>DialogFragment</b> с <b>EditText</b>. При выводе диалогового окна вам нужно установить фокус на <b>EditText</b> и показать клавиатуру:</p>

<pre><code class="java">
public class EditNameDialog extends DialogFragment {
 
    private EditText editText;
 
    public EditNameDialog() {
        // Empty constructor required for DialogFragment
    }
 
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
            Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_edit_name, container);
        editText = (EditText) view.findViewById(R.id.txt_yourName);
 
        // Request focus and show soft keyboard automatically
        editText.requestFocus();
        getDialog().getWindow().setSoftInputMode(LayoutParams.SOFT_INPUT_STATE_VISIBLE);
 
        return view;
    }
}
</code></pre>

<p>Либо используйте тег <b>&lt;requestFocus /&gt;</b> для нужного EditText.</p>

<h2 class="text-warning" id="settype">Изменить вид клавиатуры для данного EditText</h2>

<p>Когда элемент <b>EditText</b> получает фокус, то появляется клавиатура. Можно установить нужный вид клавиатуры через <a href="http://developer.alexanderklimov.ru/android/views/edittext.php#keyboard">атрибут InputType</a> или программно через метод <b>setInputType()</b>:</p>

<pre><code class="java">
EditText ipt = new EditText(this);
ipt.setInputType(InputType.TYPE_CLASS_PHONE);  //установит клавиатуру для ввода номера телефона
</code></pre>

<p>Другие варианты:</p>
<p>TYPE_CLASS_DATETIME - дата и время<br>
TYPE_CLASS_NUMBER - цифры<br>
TYPE_CLASS_TEXT - буквы</p>

<h2 class="text-warning" id="enter">Переопределяем кнопку Enter</h2>

<p>Кроме атрибута <b>InputType</b> можно также использовать атрибут <b>android:imeOptions</b> в компоненте <b>EditText</b>, который позволяет заменить кнопку <b>Enter</b> на клавиатуре на другие кнопки, например, <b>Next</b>, <b>Go</b>, <b>Search</b> и др. Возможны следующие значения:</p>

<ul>
<li><b>actionUnspecified</b>: Используется по умолчанию. Система сама выбирает нужный вид кнопки (IME_NULL)</li>
<li><b>actionGo</b>: Выводит надпись <b>Go</b>. Действует как клавиша Enter при наборе адреса в адресной строке браузера (IME_ACTION_GO)</li>
<li><b>actionSearch</b>: Выводит значок поиска (IME_ACTION_SEARCH)</li>
<li><b>actionSend</b>: Выводит надпись <b>Send</b> (IME_ACTION_SEND)</li>
<li><b>actionNext</b>: Выводит надпись <b>Next</b> (IME_ACTION_NEXT)</li>
<li><b>actionDone</b>: Выводи надпись <b>Done</b> (IME_ACTION_DONE)</li>
</ul>

<p>Чтобы увидеть все варианты воочию, можете создать несколько текстовых полей и переключаться между ними:</p>

<pre><code class="xml">
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent"
    android:orientation="vertical" &gt;

    &lt;EditText
        android:id="@+id/editSearch"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:imeOptions="actionSearch"
        android:singleLine="true" /&gt;

    &lt;EditText
        android:id="@+id/editGo"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:imeOptions="actionGo"
        android:singleLine="true" /&gt;
    
    &lt;EditText
        android:id="@+id/editSend"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:imeOptions="actionSend"
        android:singleLine="true" /&gt;
    
    &lt;EditText
        android:id="@+id/editNext"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:imeOptions="actionNext"
        android:singleLine="true" /&gt;
    
    &lt;EditText
        android:id="@+id/editDone"
        android:layout_width="fill_parent"
        android:layout_height="wrap_content"
        android:imeOptions="actionDone"
        android:singleLine="true" /&gt;

&lt;/LinearLayout&gt;
</code></pre>

<p>Чтобы реагировать на нажатия разных состояний кнопки Enter, необходимо реализовать интерфейс <b>TextView.OnEditorActionListener</b>. Небольшой пример:</p>

<pre><code class="java">
package ru.alexanderklimov.test;

import ...

public class TestActivity extends Activity implements OnEditorActionListener {
    
    EditText editSearch;
    
    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        setContentView(R.layout.activity_test);
        
        // Добавляем слушателя к компонентам
        editSearch = (EditText) findViewById(R.id.editSearch);
        editSearch.setOnEditorActionListener(this);
        EditText editGo = (EditText) findViewById(R.id.editGo);
        editGo.setOnEditorActionListener(this);
        // и так далее
    }
    
    @Override
    public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
        if (actionId == EditorInfo.IME_ACTION_SEARCH) {
            // обрабатываем нажатие кнопки поиска
            if (!editSearch.getText().toString().equals("cat")) {
                Toast.makeText(this, "Не буду ничего искать!", Toast.LENGTH_LONG).show();
            }
            return true;
        }
        if (actionId == EditorInfo.IME_ACTION_GO) {
            // обрабатываем нажатие кнопки GO
            return true;
        }
        return false;
    }
}
</code></pre>

<p>В нашем примере если пользователь ищет что-то, не связанное с котом, то кнопка поиска не будет выполнять желание владельца устройства.</p>

<p>Также можно поменять текст на кнопке с помощью атрибута <b>android:imeActionLabel</b>:</p>

<pre><code class="xml">
&lt;EditText
    android:id="@+id/editDone"
    android:layout_width="fill_parent"
    android:layout_height="wrap_content"
    android:imeOptions="actionDone"
    android:imeActionId="@+id/action_sign_in"
    android:imeActionLabel="Meow"
    android:singleLine="true" /&gt;
</code></pre>

<p>Текст на кнопке поменялся, но вот обработка Enter из предыдущего примера у меня перестала работать. Мой неработающий код на память.</p>

<pre><code class="java">
@Override
public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
    if (actionId == EditorInfo.IME_ACTION_DONE || actionId == R.id.action_sign_in) {
        // обрабатываем нажатие кнопки 
        if(mEditText.getText().toString() != "кот"){
            Toast.makeText(this, "Не буду ничего искать!", Toast.LENGTH_LONG).show();
        }
        return true;
    }
    
    return false;
}
</code></pre>

<p>Upd: Читатель Максим Г. предложил следующее решение проблемы. Убираем атрибуты <b>imeOptions</b>, <b>imeActionId</b>, <b>imeActionLabel</b> и установим их программно.</p>

<pre><code class="java">
mEditText = (EditText) findViewById(R.id.editDone);
mEditText.setOnEditorActionListener(this);
// вместо imeActionLabel и imeOptions
<b>mEditText.setImeActionLabel("Мяу", EditorInfo.IME_ACTION_DONE);</b>

@Override
public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
    boolean handled = false;
    if (actionId == EditorInfo.IME_ACTION_DONE) {
        // обрабатываем нажатие кнопки
        if(mEditText.getText().toString() != "кот"){
            Toast.makeText(this, "Не буду ничего искать!", Toast.LENGTH_LONG).show();
        }
        return handled;
    }
    return handled;
}
</code></pre>

<p>По желанию можете отслеживать только у нужного поля. Поставьте дополнительное условие после первого блока <b>if</b>:</p>

<pre><code class="java">
// только у данного поля
if (v.getId == R.id.editDone){ }
</code></pre>

<h2 class="text-warning">Интерфейс OnKeyListener</h2>

<p>Чтобы среагировать на нажатие клавиши внутри существующего представления из активности, реализуйте интерфейс <b>OnKeyListener</b> и назначьте его для объекта <b>View</b>, используя метод <b>setOnKeyListener()</b>. Вместо того, чтобы реализовывать отдельные методы для событий нажатия и отпускания клавиш, <b>OnKeyListener</b> использует единое событие <b>onKey()</b>.</p>

<pre><code class="java">
myView.setOnKeyListener(new OnKeyListener() {
  public boolean onKey(View v, int keyCode, KeyEvent event)
  {
    // TODO Обработайте нажатие клавиши, верните true, если
    // обработка выполнена
    return false;
  }
});
</code></pre>

<p>Используйте параметр <b>keyCode</b> для получения клавиши, которая была нажата. Параметр <b>KeyEvent</b> нужен для распознавания типа события (нажатие представлено константой <b>ACTION_DOWN</b>, а отпускание — <b>ACTION_UP</b>).</p>

<h2 class="text-warning" id="moveactivity">Сдвигаем активность</h2>

<p>Чтобы всплывающая клавиатура не заслоняла элемент интерфейса, который получил фокус, а сдвигала активность вверх, можно в манифесте для нужной активности прописать атрибут <b>android:windowSoftInputMode</b> с параметром <b>adjustPan</b>:</p>

<pre><code class="xml">
&lt;activity
    android:name=".CatsActivity"
    android:label="@string/app_name"
    android:windowSoftInputMode="adjustPan" &gt;
&lt;/activity&gt;
</code></pre>

<p>Также доступны и другие параметры:</p>

<ul>
<li><b>stateUnspecified</b> - настройка по умолчанию. Система сама выбирает подходящее поведение клавиатуры.</li>
<li><b>stateUnchanged</b> - клавиатура сохраняет своё последнее состояние (видимое или невидимое), когда активность с текстовым полем получает фокус.</li>
<li><b>stateHidden</b> - клавиатура скрыта, когда открывается активность. Клавиатура появится при наборе текста. Если пользователь переключится на другую активность, то клавиатура будут скрыта, но при возвращении назад клавиатура останется на экране, если она была видима при закрытии активности.</li>
<li><b>stateAlwaysHidden</b> - клавиатура всегда скрывается, если активность получает фокус.</li>
<li><b>stateVisible</b> - клавиатура видима.</li>
<li><b>stateAlwaysVisible</b> - клавиатура становится видимой, когда пользователь открывает активность.</li>
<li><b>adjustResize</b> - размеры компонентов в окне активности могут изменяться, чтобы освободить место для экранной клавиатуры.</li>
<li><b>adjustPan</b> - окно активности и его компоненты не изменяются, а сдвигаются таким образом, чтобы текстовое поле с фокусом не было закрыто клавиатурой.</li>
<li><b>adjustUnspecified</b> - настройка по умолчанию. Система сама выбирает нужный режим.</li>
</ul>

<p>Параметры с префиксом <b>state</b> можно комбинировать с настройками с префиксом <b>adjust</b>:</p>

<p id="startactivity">Например, чтобы показать клавиатуру при старте активности, используйте <b>stateVisible</b>.</p>

<pre><code class="xml">
&lt;activity android:windowSoftInputMode="stateVisible | adjustResize" /&gt;
</code></pre>

<h2 class="text-warning" id="language">Узнать выбранный язык на клавиатуре</h2>

<p>Для определения текущего языка на клавиатуре можно использовать следующий код.</p>

<pre><code class="java">
public void onClick(View view) {
    InputMethodManager imm = (InputMethodManager)getSystemService(Context.INPUT_METHOD_SERVICE);
    InputMethodSubtype ims = imm.getCurrentInputMethodSubtype();
    String localeString = ims.getLocale();
    Locale locale = new Locale(localeString);
    String currentLanguage = locale.getDisplayLanguage();
    EditText languageEditText = (EditText)findViewById(R.id.etNewItem);
    Toast.makeText(getApplicationContext(), currentLanguage, Toast.LENGTH_SHORT).show();
}
</code></pre>

<p>Следует быть осторожным с примером. На эмуляторе с Android 6.0 пример работал корректно. На реальных устройствах у меня корректно определялся русский язык, но при переключении на английский язык выдавал пустую строку или значение "zz". В этом случае можно прибегнуть к условиям <b>if</b> и проверять ожидаемое значение.</p>

<h2 class="text-warning">Дополнительное чтение</h2>

<p><a href="http://forum.alexanderklimov.ru/viewtopic.php?id=21">Обсуждение статьи</a> на форуме.</p>

<h5 class="text-error">Реклама</h5>

<script type="text/javascript"><!--
google_ad_client = "ca-pub-4224968932772057";
/* Полноразмерный баннер 728х90 */
google_ad_slot = "4077523505";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>


</div><!--/span-->
</div><!--/row-->	
</div><!--/span-->
		
	<div class="col-md-2">
        <div class="well sidebar-nav">
    <h4><span class="label label-info">Реклама</span></h4>
    <script type="text/javascript">
    google_ad_client = "ca-pub-4224968932772057";
    google_ad_slot = "8217353101";
    google_ad_width = 160;
    google_ad_height = 600;
</script>
<!-- 160 x 600 -->
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div><!--/.well -->    </div><!--/span-->
</div><!--/row-->
	
<hr>
	  
<div class="row">
	<div class="col-md-12">
	    <img src="./19. Клавиатура и аппаратные кнопки_files/cat_bottom.png" align="right">
    </div><!--/span-->
</div><!--/row-->

<footer>
    <noindex>
    <span style="float:left; margin:3px 1px 1px 2px;">
	    © 2016 <a href="mailto:rusproject@mail.ru">А.Климов</a>
		<!-- Place this code where you want the badge to render. -->
        <a href="http://plus.google.com/109061106977829925124?prsrc=3" rel="publisher" style="text-decoration:none;">
        <img src="http://ssl.gstatic.com/images/icons/gplus-16.png" alt="Google+" style="border: 0px; width: 16px; height: 16px; display: none !important;" hidden="" nszz82r=""></a>
    </span>
	
    <span style="float: right; margin:3px 5px 1px 1px; font-size:22px;">
        <!--Rating@Mail.ru LOGO--><a target="_top" href="http://top.mail.ru/jump?from=228158"><img src="http://db.c7.b3.a0.top.mail.ru/counter?id=228158;t=223;l=1" border="0" height="31" width="88" alt="Рейтинг@Mail.ru" hidden="" style="display: none !important;"></a><!--/LOGO-->
	</span>
    
    <span style="float: right; margin:2px 70px 1px 1px; font-size:22px;">
        <a href="http://feeds.feedburner.com/alexanderklimov/VJcl"><img src="./19. Клавиатура и аппаратные кнопки_files/VJcl" height="26" width="88" style="border: 0px; display: none !important;" alt="" hidden=""></a>
	</span>
	
<div style="float: right; margin:2px 70px 1px 1px;">
    <!-- Place this tag where you want the +1 button to render. -->
    <div id="___plusone_0" style="position: absolute; width: 450px; left: -10000px;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: absolute; top: -10000px; width: 450px; margin: 0px; border-style: none; display: none !important;" tabindex="0" vspace="0" width="100%" id="I0_1476609918063" name="I0_1476609918063" src="./19. Клавиатура и аппаратные кнопки_files/fastbutton.html" data-gapiattached="true" hidden=""></iframe></div><div class="g-plusone" data-size="small" data-annotation="inline" data-width="300" data-align="right" data-gapiscan="true" data-onload="true" data-gapistub="true" nszz82r="" hidden=""></div>
</div>

<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
  window.___gcfg = {lang: 'ru'};

  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
	
</noindex>
</footer>

</div><!--/.fluid-container-->    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./19. Клавиатура и аппаратные кнопки_files/jquery-1.11.0.min.js.Без названия"></script>
	<script src="./19. Клавиатура и аппаратные кнопки_files/jquery-migrate-1.2.1.min.js.Без названия"></script>
    <!-- 
    <script src="http://developer.alexanderklimov.ru/assets/js/jquery.js"></script> 
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-transition.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-alert.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-modal.js"></script> 
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-dropdown.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-scrollspy.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-tab.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-tooltip.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-popover.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-button.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-collapse.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-carousel.js"></script>
    <script src="http://developer.alexanderklimov.ru/assets/js/bootstrap-typeahead.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    -->
    
    <script src="./19. Клавиатура и аппаратные кнопки_files/backtotop.js.Без названия"></script>
    <script src="./19. Клавиатура и аппаратные кнопки_files/bootstrap.min.js.Без названия" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    
    
    


<iframe name="oauth2relay312567480" id="oauth2relay312567480" src="./19. Клавиатура и аппаратные кнопки_files/postmessageRelay.html" tabindex="-1" aria-hidden="true" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe></body><span class="gr__tooltip"><span class="gr__tooltip-content"></span><i class="gr__tooltip-logo"></i><span class="gr__triangle"></span></span></html>